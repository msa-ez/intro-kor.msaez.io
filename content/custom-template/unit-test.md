---
description: ''
sidebar: 'started'
---
# Unit Test 생성 토핑(New)

## 개요
단위 테스트를 하기 위한 코드를 자동으로 생성하는 토핑이 추가되었습니다.

![스크린샷 2023-11-06 오후 4 39 33](https://github.com/msa-ez/msa-ez.github.io/assets/113568664/3569acfc-36bd-464e-8944-1bf2a0e589e7)

## 세부 스펙

마켓플레이스에 가보면 Unit Test 토핑을 선택할 수 있고, 이를 적용하면 마이크로서비스 소스 내에 test 라는 폴더가 생성됩니다.

![스크린샷 2023-11-06 오후 4 52 24](https://github.com/msa-ez/msa-ez.github.io/assets/113568664/ecb2ef37-e8cc-42cc-84f6-01e54179888d)

test 폴더 내에는 도메인 이벤트에 대한 policy 명으로 테스트 파일이 생성된다.

![스크린샷 2023-11-06 오후 4 53 42](https://github.com/msa-ez/msa-ez.github.io/assets/113568664/7cd50ed9-431d-4125-9800-d8f6a06b7e91)

코드를 살펴보면 given에서 엔티티에 대한 재고량과 상품 아이디 등의 데이터를 보여주고, when에서 들어온 주문 정보를 보여주고, 이벤트가 퍼블리쉬되면 then에서 받은 메시지에 따른 결과가 표시됩니다.

비즈니스를 설계하는 입장에서 모델링 단계에서 example을 define 해놓으면 구현하는 개발자의 입장에서는 비즈니스 로직을 제대로 설계했는지에 대한 테스트가 진행돼야 합니다.

로직이 작동하면 폴리시핸들러를 통해 이벤트가 수신되고 해당 이벤트를 받아서 도메인 로직이 작동하는데, 로직이 실제 데이터 업데이트를 하기 위해 이벤트에 대한 처리를 진행하고 그 결과가 잘 만들어지면 테스트가 정상적으로 완료됩니다.

이렇게 단위테스트를 활용하면 내부적으로 스프링 프레임워크에 의해 이벤트가 퍼블리쉬되고 메시지컬렉터를 통해 결과를 받을 수 있어, 실제 카프카 서버 없이 로컬에서 자체적으로 테스트가 가능합니다.

## 실제 적용

![스크린샷 2023-11-06 오후 4 58 00](https://github.com/msa-ez/msa-ez.github.io/assets/113568664/0877f676-4085-4ffd-9832-ebb06dc56a5c)

깃파드에서 실제 운용을 해보면 앞서 code preview에서 본 것과 같이 인벤토리 마이크로서비스 폴더 내에 테스트 코드가 들어와있고,

![스크린샷 2023-11-06 오후 4 59 19](https://github.com/msa-ez/msa-ez.github.io/assets/113568664/bd543df7-9616-4eb3-b96e-734acd80c923)

단위 테스트를 진행하고자 하는 폴더에서 터미널을 열어 mvn test 명령어를 입력하면 비즈니스 로직에 대한 검증이 진행됩니다.